SELECT DISTINCT city,latitude,longitude,city AS name,(SELECT group_concat(DISTINCT concat(TRIM(LEADING '0' FROM fft2.team_number),' - ',fft2.team_name,' - ',fft2.affiliation)separator '<br/>')FROM fim_ftc_teams fft2 WHERE d.city = fft2.city ORDER BY fft2.rookie_year)AS info,'https://nbrobotics.team/images/FIRSTicon_45px.png' AS icon,round(distanceMiles,2)AS Distance_Miles,round(distanceKM,2)AS Distance_KM FROM(SELECT z.team_number,z.affiliation,z.team_name,z.city,z.latitude,z.longitude,p.radius,p.distanceKM * DEGREES(ACOS(LEAST(1.0,COS(RADIANS(p.latpoint))* COS(RADIANS(z.latitude))* COS(RADIANS(p.longpoint - z.longitude))+ SIN(RADIANS(p.latpoint))* SIN(RADIANS(z.latitude)))))AS distanceKM,p.distanceMiles * DEGREES(ACOS(LEAST(1.0,COS(RADIANS(p.latpoint))* COS(RADIANS(z.latitude))* COS(RADIANS(p.longpoint - z.longitude))+ SIN(RADIANS(p.latpoint))* SIN(RADIANS(z.latitude)))))AS distanceMiles FROM fim_ftc_teams AS z JOIN(/* these are the query parameters */ SELECT get_city_lat('vassar')AS latpoint,get_city_lon('vassar')AS longpoint,50.0 AS radius,111.045 AS distanceKM,69.0 AS distanceMiles)AS p ON 1=1 WHERE z.latitude BETWEEN p.latpoint -(p.radius / p.distanceKM)AND p.latpoint +(p.radius / p.distanceKM)AND z.longitude BETWEEN p.longpoint -(p.radius /(p.distanceKM * COS(RADIANS(p.latpoint))))AND p.longpoint +(p.radius /(p.distanceKM * COS(RADIANS(p.latpoint)))))AS d WHERE distanceMiles <= radius ORDER BY distanceKM LIMIT 15 